{% extends 'base.html' %}

{% block title %}
Home |
{% endblock title %}

{% block body %}
<div class="container-fluid px-0 py-0">

  <div id="carouselExampleIndicators" class="carousel slide" data-ride="carousel">
  <ol class="carousel-indicators">
    <li data-target="#carouselExampleIndicators" data-slide-to="0" class="active"></li>
    <li data-target="#carouselExampleIndicators" data-slide-to="1"></li>
    <li data-target="#carouselExampleIndicators" data-slide-to="2"></li>
  </ol>
  <div class="carousel-inner">

    <div class="carousel-item active">
      <img src="https://source.unsplash.com/1600x600/?icecream" class="d-block w-100" alt="2nd">
    </div>
    <div class="carousel-item">
      <img src="https://source.unsplash.com/1600x600/?chocolate" class="d-block w-100" alt="2nd">
    </div>
    <div class="carousel-item">
      <img src="https://source.unsplash.com/1600x600/?dessert,creme" class="d-block w-100" alt="3rd">
    </div>
  </div>
  <a class="carousel-control-prev" href="#carouselExampleIndicators" role="button" data-slide="prev">
    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
    <span class="sr-only">Previous</span>
  </a>
  <a class="carousel-control-next" href="#carouselExampleIndicators" role="button" data-slide="next">
    <span class="carousel-control-next-icon" aria-hidden="true"></span>
    <span class="sr-only">Next</span>
  </a>
</div>
</div>
<br>



<!-- Cards dos gelados -->

<div class="container">
  <h1 class="my-2 text-center">Refresca o teu Verão com a nossa vasta gama de gelados</h1>
      <div class="row">
        <div class="col-md-4">
          <div class="card mb-4 shadow-sm">
            <img src="https://source.unsplash.com/1200x900/?icecrem,creme" class="d-block w-100" alt="3rd">
            <div class="card-body" >
              <h5 class="card-title" id="namepr1">Produto 1</h5>
              <p class="card-text">Descrição breve sobre o produto</p>
             <h6 class="card-title" >Preço <span id="pricepr1"> por definir </span></h6>
              <div class="d-flex justify-content-between align-items-center">
                <div class="btn-group">
                  <button type="button" id="pr1" class="btn btn-sm btn-outline-secondary cart">Adicionar ao carrinho</button></span>

                </div>
                <small class="text-muted">RRP</small>
              </div>
            </div>
          </div>
        </div>
        <div class="col-md-4">
          <div class="card mb-4 shadow-sm">
            <img src="https://source.unsplash.com/1200x900/?dessert" class="d-block w-100" alt="3rd">
            <div class="card-body">
              <h5 class="card-title" id="namepr2">Produto 2</h5>
              <p class="card-text">Descrição breve sobre o produto</p>
             <h6 class="card-title" >Preço <span id="pricepr1"> por definir </span></h6>
              <div class="d-flex justify-content-between align-items-center">
                <div class="btn-group">
                  <span id="divpr2" class="divpr">
                  <button type="button" id="pr2" class="btn btn-sm btn-outline-secondary cart">Adicionar ao carrinho</button></span>
                </div>
                <small class="text-muted">RRP</small>
              </div>
            </div>
          </div>
        </div>
        <div class="col-md-4">
          <div class="card mb-4 shadow-sm">
            <img src="https://source.unsplash.com/1200x900/?creme" class="d-block w-100" alt="3rd">
            <div class="card-body">
              <h5 class="card-title" id="namepr3">Produto 3</h5>
              <p class="card-text">Descrição breve sobre o produto</p>
             <h6 class="card-title" >Preço <span id="pricepr1"> por definir </span></h6>
              <div class="d-flex justify-content-between align-items-center">
                <div class="btn-group">
                 <span id="divpr3" class="divpr">
                  <button type="button" id="pr3" class="btn btn-sm btn-outline-secondary cart">Adicionar ao carrinho</button></span>
                </div>
                <small class="text-muted">RRP</small>
              </div>
            </div>
          </div>
        </div>

        <div class="col-md-4">
          <div class="card mb-4 shadow-sm">
            <img src="https://source.unsplash.com/1200x900/?cream" class="d-block w-100" alt="3rd">
            <div class="card-body">
              <h5 class="card-title" id="namepr4">Produto 4</h5>
              <p class="card-text">Descrição breve sobre o produto</p>
             <h6 class="card-title" >Preço <span id="pricepr1"> por definir </span></h6>
              <div class="d-flex justify-content-between align-items-center">
                <div class="btn-group">
                <span id="divpr4" class="divpr">
                  <button type="button" id="pr4" class="btn btn-sm btn-outline-secondary cart">Adicionar ao carrinho</button></span>
                </div>
                <small class="text-muted">RRP</small>
              </div>
            </div>
          </div>
        </div>
        <div class="col-md-4">
          <div class="card mb-4 shadow-sm">
            <img src="https://source.unsplash.com/1200x900/?sweets" class="d-block w-100" alt="3rd">
            <div class="card-body">
              <h5 class="card-title" id="namepr5">Produto 5</h5>
              <p class="card-text">Descrição breve sobre o produto</p>
             <h6 class="card-title" >Preço <span id="pricepr1"> por definir </span></h6>
              <div class="d-flex justify-content-between align-items-center">
                <div class="btn-group">
                  <span id="divpr5" class="divpr">
                  <button type="button" id="pr5" class="btn btn-sm btn-outline-secondary cart">Adicionar ao carrinho</button></span>
                </div>
                <small class="text-muted">RRP</small>
              </div>
            </div>
          </div>
        </div>
        <div class="col-md-4">
          <div class="card mb-4 shadow-sm">
            <img src="https://source.unsplash.com/1200x900/?chocolate" class="d-block w-100" alt="3rd">
            <div class="card-body">
              <h5 class="card-title" id="namepr6">Produto 6</h5>
              <p class="card-text">Descrição breve sobre o produto</p>
             <h6 class="card-title" >Preço <span id="pricepr1"> por definir </span></h6>
              <div class="d-flex justify-content-between align-items-center">
                <div class="btn-group">
                  <span id="divpr6" class="divpr">
                  <button type="button" id="pr6" class="btn btn-sm btn-outline-secondary cart">Adicionar ao carrinho</button></span>
                </div>
                <small class="text-muted">RRP</small>
              </div>
            </div>
          </div>
        </div>

        <div class="col-md-4">
          <div class="card mb-4 shadow-sm">
            <img src="https://source.unsplash.com/1200x900/?dessert,creme" class="d-block w-100" alt="3rd">
            <div class="card-body">
              <h5 class="card-title" id="namepr7">Produto 7</h5>
              <p class="card-text">Descrição breve sobre o produto</p>
             <h6 class="card-title" >Preço <span id="pricepr1"> por definir </span></h6>
              <div class="d-flex justify-content-between align-items-center">
                <div class="btn-group">
                  <span id="divpr7" class="divpr">
                  <button type="button" id="pr7" class="btn btn-sm btn-outline-secondary cart">Adicionar ao carrinho</button></span>
                </div>
                <small class="text-muted">RRP</small>
              </div>
            </div>
          </div>
        </div>
        <div class="col-md-4">
          <div class="card mb-4 shadow-sm">
            <img src="https://source.unsplash.com/1200x900/?dessert" class="d-block w-100" alt="3rd">
            <div class="card-body">
              <h5 class="card-title" id="namepr8">Produto 8</h5>
              <p class="card-text">Descrição breve sobre o produto</p>
             <h6 class="card-title" >Preço <span id="pricepr1"> por definir </span></h6>
              <div class="d-flex justify-content-between align-items-center">
                <div class="btn-group">
                  <span id="divpr8" class="divpr">
                  <button type="button" id="pr8" class="btn btn-sm btn-outline-secondary cart">Adicionar ao carrinho</button></span>
                </div>
                <small class="text-muted">RRP</small>
              </div>
            </div>
          </div>
        </div>
        <div class="col-md-4">
          <div class="card mb-4 shadow-sm">
            <img src="https://source.unsplash.com/1200x900/?creme" class="d-block w-100" alt="3rd">
            <span class="card-body">
              <h5 class="card-title" id="namepr9">Produto 9</h5>
              <p class="card-text">Descrição breve sobre o produto</p>
             <h6 class="card-title" >Preço <span id="pricepr1"> por definir </span></h6>
              <div class="d-flex justify-content-between align-items-center">
                <div class="btn-group">
                  <span id="divpr9" class="divpr">
                  <button type="button" id="pr9" class="btn btn-sm btn-outline-secondary cart">Adicionar ao carrinho</button></span>
                </div>
                <small class="text-muted">RRP</small>
              </div>
            </div>
          </div>
        </div>
      </div>

  <!-- JS para adicionar produtos ao carrinho -->

  {% block js%}

    <script>
       
         if (localStorage.getItem('cart')==null){
             var cart={};
             }
         else {
           cart =JSON.parse(localStorage.getItem('cart'));

           updateCart(cart);
           }

   // Adicionar/remover itens do carrinho


          $(".divpr").on('click','button.cart',function(){
              var idstr= this.id.toString();

              if(cart[idstr] !=undefined)
                {  qty=cart[idstr][0] + 1;
                }
              else
                {
                 qty=1;
                   name=document.getElementById('name'+idstr).innerHTML;
                   price=document.getElementById('price'+idstr).innerHTML;
                  cart[idstr] =[qty,name,parseInt(price)];
                }

              updateCart(cart);
              localStorage.setItem('cart',JSON.stringify(cart));
              document.getElementById("cart").innerHTML = Object.keys(cart).length;
       });

       $('#popcart').popover();

    

     updatePopover(cart);

     function updatePopover(cart){
        
         var popstr="";
         popstr= popstr + "<h5>O teu carrinho</h5>";
         var i=1;
         for (var item in cart){
         popstr= popstr + "<b>" + i + "</b>"+" <b> - </b>";
         popstr= popstr + document.getElementById('name'+item).innerHTML.slice(0,19) + " Qty: " + cart[item][0] + '<br>';
         i=i+1;
         }

         popstr = popstr + "</div> <a href='/checkout'><button class='btn btn-outline-secondary my-3' id ='checkout'>Checkout</button></a> <button class='btn btn-outline-primary my-3' onclick='clearCart()' id ='clearCart'>Clear Cart</button> ";
   
        
         document.getElementById('popcart').setAttribute('data-content',popstr);
          $('#popcart').popover();
        }



    function clearCart() {
    cart = JSON.parse(localStorage.getItem('cart'));
    for (var item in cart) {
        document.getElementById('div' + item).innerHTML = '<button id="' + item + '" class="btn btn-sm btn-outline-secondary cart">Adicionar ao carrinho</button>';
    }
    localStorage.clear();
    cart = {};
    updateCart(cart);
    }



   function updateCart(cart) {
   var sum =0;
    for (var item in cart) {
    sum=sum+cart[item][0];
      document.getElementById('div' + item).innerHTML =
      "<button id='minus" + item + "' class='btn btn-primary minus'>-</button> <span id='val" + item + "''>" + cart[item][0] +
      "</span> <button id='plus" + item + "' class='btn btn-primary plus'> + </button>";
    }
    localStorage.setItem('cart',JSON.stringify(cart));
      document.getElementById("cart").innerHTML =sum;
      updatePopover(cart);

    }

    // Se o botão de + ou de - for clicado, muda o valor do carrinho
        $('.divpr').on("click", "button.minus", function() {
        a = this.id.slice(7, );
        cart['pr' + a][0] = cart['pr' + a][0] - 1;
        cart['pr' + a][0] = Math.max(0, cart['pr' + a][0]);
        document.getElementById('valpr' + a).innerHTML = cart['pr' + a][0];
        updateCart(cart);

         });

        $('.divpr').on("click", "button.plus", function() {
        a = this.id.slice(6, );
        cart['pr' + a][0] = cart['pr' + a][0] + 1;
        document.getElementById('valpr' + a).innerHTML = cart['pr' + a][0];
        updateCart(cart);
      });


     </script>
  {% endblock %}

{% endblock body %}
